<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session fb74d1b9-6240-430d-ac8a-99b9808f8208 (2025-09-04 11:56Z) -->

# Unsupported method error on API endpoint (2025-09-04 11:56Z)

_**User (2025-09-03 18:33Z)**_

{"error":"Method not supported on endpoint /v1/GetLocation: GET. Please refer to the api documentation at http://www.miataru.com/#tabr4"}

---

_**Agent (model default, mode Agent)**_

I can see you're getting an error about the GET method not being supported on the `/v1/GetLocation` endpoint. Let me examine the current code to understand the issue and help you fix it.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/bietiekay/code/miataru-server/tests/integration/updateLocation.tests.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/bietiekay/code/miataru-server/lib/routes/location/v1/location.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/bietiekay/code/miataru-server/lib/routes/location/v1/index.js</summary>

</details>
</tool-use>

---

Now let me check the main routing configuration to see how the endpoints are set up:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/bietiekay/code/miataru-server/lib/routes/location/index.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/bietiekay/code/miataru-server/lib/routes/index.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/bietiekay/code/miataru-server/server.js</summary>

</details>
</tool-use>

---

Now I can see the issue! Looking at the routing configuration in `/home/bietiekay/code/miataru-server/lib/routes/location/index.js`, I can see that:

1. The `/v1/GetLocation` endpoint is configured to only accept **POST** requests (line 10)
2. There are catch-all handlers (lines 35-45) that return "Method not supported" errors for any non-POST requests to these endpoints

The error you're seeing indicates that you're trying to make a **GET** request to `/v1/GetLocation`, but the API only supports **POST** requests for this endpoint.

Let me also check what the expected request format should be:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/bietiekay/code/miataru-server/tests/testFiles/calls.js</summary>

</details>
</tool-use>

---

Perfect! Now I understand the issue completely. The `/v1/GetLocation` endpoint expects a **POST** request with a JSON body containing the device information, not a GET request.

## The Problem

You're trying to make a **GET** request to `/v1/GetLocation`, but this endpoint only accepts **POST** requests. The API is designed to use POST for all location-related operations.

## The Solution

You need to change your request from GET to POST and include the proper JSON body. Here's how to make the correct request:

### Correct Request Format

**Method:** POST  
**URL:** `/v1/GetLocation`  
**Content-Type:** `application/json`  
**Body:**
```json
{
    "MiataruGetLocation": [
        {
            "Device": "your-device-id-here"
        }
    ]
}
```

### Example using curl:
```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{"MiataruGetLocation":[{"Device":"your-device-id"}]}' \
  http://localhost:3000/v1/GetLocation
```

### Example using JavaScript fetch:
```javascript
fetch('/v1/GetLocation', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        "MiataruGetLocation": [
            {
                "Device": "your-device-id"
            }
        ]
    })
})
.then(response => response.json())
.then(data => console.log(data));
```

The API is designed this way because it needs to receive the device ID(s) in the request body to know which device(s) to retrieve location data for. This is consistent with the Miataru API specification as referenced in the error message.

---

